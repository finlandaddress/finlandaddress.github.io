<!DOCTYPE html>
<html lang="zh-CN">

<head>
        <link rel="canonical" href="https://finlandaddress.github.io/html/category/article-652.htm" />
    <title>Spring Security——【认证、授权、注销及权限控制】 - FinlandAddress</title>
        <meta charset="utf-8">
    <link rel="icon" href="/assets/addons/xcblog/img/finlandaddress/favicon.ico" type="image/x-icon"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/font-awesome.min.css" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/animate.css" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/owl.carousel.min.css" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/owl.theme.default.min.css" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/magnific-popup.css" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/flaticon.css" rel="stylesheet" />
    <link href="/assets/addons/xcblog/css/finlandaddress/style.css" rel="stylesheet" />
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a045e5bb3ae69629060e7ce2a4b98902";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body>
        <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar ftco-navbar-light site-navbar-target" id="ftco-navbar">
        <div class="container">
                        <a class="navbar-brand" href="/">Finland Address<span></span></a>
            
            <button class="navbar-toggler js-fh5co-nav-toggle fh5co-nav-toggle" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> MENU
            </button>
            <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav nav ml-auto">
                	                    <li class="nav-item"><a href="/" class="nav-link"><span>首页</span></a></li>
                                        <li class="nav-item"><a href="/html/category/" class="nav-link"><span>文章分类</span></a></li>
                                        <li class="nav-item"><a href="#" class="nav-link"><span>关于</span></a></li>
                    <li class="nav-item"><a href="#" class="nav-link"><span>联系</span></a></li>
                </ul>
            </div>
        </div>
    </nav>
    <section class="hero-wrap" style="height:350px;overflow: hidden;">
        <div class="overlay"></div>
        <div class="container-fluid px-0">
            <div class="row d-md-flex no-gutters slider-text align-items-center js-fullheight justify-content-end">
                <img class="one-third js-fullheight align-self-end order-md-last img-fluid" src="/assets/addons/xcblog/img/finlandaddress/undraw_book_lover_mkck.svg" alt="" style="opacity: 0.5;">
                <div class="one-forth d-flex align-items-center ftco-animate js-fullheight">
                    <div class="text" style="top: 30%;min-width: 70%;">
                        <h1>Spring Security——【认证、授权、注销及权限控制】</h1>
                        <p>
                            <a href="/">首页</a> / <a href="/html/category/">文章分类</a> / <span>正文</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="ftco-about img ftco-section" id="about-section">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                	  				  				  				<div id="content_views" class="htmledit_views"> <p id="main-toc"><strong>目录</strong></p> <p id="Spring%20Security%E7%AE%80%E4%BB%8B%EF%BC%9A-toc" style="margin-left:0px;">Spring Security简介：</p> <p id="%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%9A-toc" style="margin-left:0px;">实验环境搭建：</p> <p id="%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83-toc" style="margin-left:0px;">认证和授权</p> <p id="%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B3%A8%E9%94%80-toc" style="margin-left:0px;">权限控制和注销</p> <hr id="hr-toc"/> <h1 id="Spring%20Security%E7%AE%80%E4%BB%8B%EF%BC%9A">Spring Security简介：</h1> <p>Spring Security 是针对Spring项目的安全框架，也是Spring Boot底层安全模块默认的技术选型，它可以实现强大的Web安全控制，对于安全控制，我们只需要引入&nbsp;spring-boot-starter-security&nbsp;模块，进行少量的配置，即可实现强大的安全管理！</p> <p>记住几个类：</p> <ul> <li> <p>WebSecurityConfigurerAdapter：自定义Security策略</p> </li> <li> <p>AuthenticationManagerBuilder：自定义认证策略</p> </li> <li> <p>@EnableWebSecurity：开启WebSecurity模式</p> </li> </ul> <p>Spring Security的两个主要目标是 “认证” 和 “授权”（访问控制）。</p> <p><strong>“认证”（Authentication）</strong></p> <p>身份验证是关于验证您的凭据，如用户名/用户ID和密码，以验证您的身份。</p> <p>身份验证通常通过用户名和密码完成，有时与身份验证因素结合使用。</p> <p><strong>“授权” （Authorization）</strong></p> <p>授权发生在系统成功验证您的身份后，最终会授予您访问资源（如信息，文件，数据库，资金，位置，几乎任何内容）的完全权限。</p> <p>这个概念是通用的，而不是只在Spring Security 中存在。</p> <p>Spring Security 框架对于认证和授权很好的支持。在用户认证方面，Spring Security 框架支持主流的认证方式，包括 HTTP 基本认证、HTTP 表单验证、HTTP 摘要认证、OpenID 和 LDAP 等。在用户授权方面，Spring Security 提供了基于角色的访问控制和访问控制列表（Access Control List，ACL），可以对应用中的领域对象进行细粒度的控制。</p> <p>下面是spring security官网：Spring Security&nbsp; &nbsp;找到对应的官方文档：Spring Security Reference</p> <p><img fetchpriority="high" decoding="async" alt="" height="647" src="http://img.555519.xyz/uploads/20230112/ca6e329478800ffa48f361be3daf8c15.jpg"></p> <h1 id="%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%9A">实验环境搭建：</h1> <p>1.新建一个初始的springboot项目web模块，thymeleaf模块</p> <p>2.导入静态资源</p> <p><img decoding="async" alt="" height="585" src="http://img.555519.xyz/uploads/20230112/b585396da87763626fb74bac62b765f9.jpg"></p> <p>&nbsp;3、controller跳转！</p> <p><img decoding="async" alt="" height="532" src="http://img.555519.xyz/uploads/20230112/1e4e52e1ee40dbf19895b7bc85a5a92c.jpg"></p> <p>&nbsp;4、测试实验环境是否成功</p> <h1 id="%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83">认证和授权</h1> <p>我们测试的环境，是谁都可以访问，现在我们使用&nbsp;Spring Security&nbsp;增加上认证和授权的功能</p> <p>1、引入 Spring Security 模块</p> <pre><code class="language-XML"><dependency>    <groupId>org.springframework.boot</groupId>    spring-boot-starter-security</artifactId> </dependency></code></pre> <p>2、编写 Spring Security 配置类</p> <p>&nbsp;参考对应的官方文档：<a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=https://docs.spring.io/spring-security/site/docs/5.3.0.RELEASE/reference/html5/#jc"  title="Spring Security Reference" rel="nofollow">Spring Security Reference</p> <p><img loading="lazy" decoding="async" alt="" height="345" src="http://img.555519.xyz/uploads/20230112/16a7f2013290598f8036c5a3cd1491e3.jpg"></p> <p>3、编写基础配置类</p> <pre><code class="language-java">@EnableWebSecurity // 开启WebSecurity模式 public class SecurityConfig extends WebSecurityConfigurerAdapter {     @Override    protected void configure(HttpSecurity http) throws Exception {           } }</code></pre> <p>4.定义授权的规则:</p> <p>在配置类中看授权的源码:</p> <p><img loading="lazy" decoding="async" alt="" height="208" src="http://img.555519.xyz/uploads/20230112/5131376a4e2499f0821266a83a5583c8.jpg"></p> <p><img loading="lazy" decoding="async" alt="" height="262" src="http://img.555519.xyz/uploads/20230112/e1f98ea7233a6fbfbc506b8298792541.jpg"></p> <p>&nbsp;5、测试，发现除了首页都进不去了！因为我们目前没有登录的角色，因为请求需要登录的角色拥有对应的权限才可以！</p> <p>&nbsp;6、在configure()方法中加入以下配置，开启自动配置的登录功能！</p> <p>从源码解释中看</p> <p><img loading="lazy" decoding="async" alt="" height="133" src="http://img.555519.xyz/uploads/20230112/cf27882b4abc58608734d33146f06db9.jpg"></p> <pre><code class="language-java">// 开启自动配置的登录功能 // /login 请求来到登录页 // /login?error 重定向到这里表示登录失败 http.formLogin();</code></pre> <p>&nbsp;7、测试一下：发现，没有权限的时候，会跳转到登录的页面！</p> <p><img loading="lazy" decoding="async" alt="" height="303" src="http://img.555519.xyz/uploads/20230112/5a0bd38e9a83500eb0a7c114c1b1f0aa.jpg"></p> <p>8、查看刚才登录页的注释信息；</p> <p>我们可以定义认证规则，从源码中查看</p> <p><img loading="lazy" decoding="async" alt="" height="222" src="http://img.555519.xyz/uploads/20230112/5d514757fc938abede77b4105a0b180a.jpg"></p> <p>重写configure(AuthenticationManagerBuilder auth)方法</p> <pre><code class="language-java">//定义认证规则 @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception {        //在内存中定义，也可以在jdbc中去拿....    auth.inMemoryAuthentication()           .withUser("kuangshen").password("123456").roles("vip2","vip3")           .and()           .withUser("root").password("123456").roles("vip1","vip2","vip3")           .and()           .withUser("guest").password("123456").roles("vip1","vip2"); }</code></pre> <p>9、测试，我们可以使用这些账号登录进行测试！发现会报错！</p> <p>There is no PasswordEncoder mapped for the id “null”</p> <p>10、原因，我们要将前端传过来的密码进行某种方式加密，否则就无法登录，修改代码</p> <p><img loading="lazy" decoding="async" alt="" height="295" src="http://img.555519.xyz/uploads/20230112/fdddcf415bbad0b6d740946404056297.jpg"></p> <p>&nbsp;11、测试，登录成功，并且每个角色只能访问自己认证下的规则</p> <h1 id="%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E5%92%8C%E6%B3%A8%E9%94%80">权限控制和注销</h1> <p>1、开启自动配置的注销的功能</p> <p><img loading="lazy" decoding="async" alt="" height="58" src="http://img.555519.xyz/uploads/20230112/32214b631cf38222e33072a365b9a958.jpg"></p> <p>2、在前端，增加一个注销的按钮，index.html 导航栏中</p> <pre><code class="language-html">    <i class="sign-out icon"></i> 注销 </code></pre> <p>3、可以去测试一下，登录成功后点击注销，发现注销完毕会跳转到登录页面！</p> <p>4、但是，我们想让他注销成功后，依旧可以跳转到首页，该怎么处理呢？</p> <pre><code class="language-java">// .logoutSuccessUrl("/"); 注销成功来到首页 http.logout().logoutSuccessUrl("/");</code></pre> <p>5、测试，注销完毕后，发现跳转到首页OK</p> <p>6、现在来一个需求：用户没有登录的时候，导航栏上只显示登录按钮，用户登录之后，导航栏可以显示登录的用户信息及注销按钮！还有就是，比如longdi这个用户，它只有 vip2，vip3功能，那么登录则只显示这两个功能，而vip1的功能菜单不显示！这个就是真实的网站情况了！</p> <p>我们需要结合thymeleaf中的一些功能</p> <p>sec：authorize="isAuthenticated()":是否认证登录！来显示不同的页面</p> <p>Maven依赖：</p> <pre><code class="language-XML"><dependency>    <groupId>org.thymeleaf.extras</groupId>    <artifactId>thymeleaf-extras-springsecurity5</artifactId>    <version>3.0.4.RELEASE</version> </dependency></code></pre> <p>7、修改我们的 前端页面</p> <p>导入命名空间 xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"</p> <p>修改导航栏，增加认证判断</p> <p>8、重启测试，可以登录试试看，登录成功后确实，显示了我们想要的页面；</p> <p>9、如果注销404了，就是因为它默认防止csrf跨站请求伪造，因为会产生安全问题，可以将请求改为post表单提交，或者在spring security中关闭csrf功能；试试在 配置中增加</p> <p><img loading="lazy" decoding="async" alt="" height="59" src="http://img.555519.xyz/uploads/20230112/7ae0353991b0125c447880e27f273fa0.jpg"></p> <p>&nbsp;10、继续将下面的角色功能块认证完成！测试成功！</p> </p></div> 			
                    <div class="col-md-12 mt-5">
                                                <p>上一个：<a href="/html/category/article-651.htm">如果我们将日期成分和时间成分作为TIMEDIFF()函数的参数，MySQL将返回什么？</a></p>
                                                <p>下一个：<a href="/html/category/article-653.htm">idea中的Maven项目怎么配置Tomcat部署</a></p>
                                            </div>

                                    </div>
                <div class="col-md-3">
                	<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/html/category/article-7032.htm" title="领养宠物合同协议书模板图片下载（宠物领养协议书怎么写）">领养宠物合同协议书模板图片下载（宠物领养协议书怎么写）</a></li>
                        <li class="py-2"><a href="/html/category/article-6757.htm" title="亚麻服装品牌女款(亚麻时尚女装)">亚麻服装品牌女款(亚麻时尚女装)</a></li>
                        <li class="py-2"><a href="/html/category/article-7814.htm" title="宠康动物诊所（宠康动物医院怎么样）">宠康动物诊所（宠康动物医院怎么样）</a></li>
                        <li class="py-2"><a href="/html/category/article-7078.htm" title="动物疫苗排行榜 动物疫苗排行榜前十名">动物疫苗排行榜 动物疫苗排行榜前十名</a></li>
                        <li class="py-2"><a href="/html/category/article-7170.htm" title="12种最适合学生养的宠物,不会长大的（适合学生养的小宠）">12种最适合学生养的宠物,不会长大的（适合学生养的小宠）</a></li>
                        <li class="py-2"><a href="/html/category/article-7860.htm" title="动物疫苗发展现状及未来展望论文 动物疫苗发展现状及未来展望论文怎么写">动物疫苗发展现状及未来展望论文 动物疫苗发展现状及未来展望论文怎么写</a></li>
                        <li class="py-2"><a href="/html/category/article-7538.htm" title="领养宠物狗app（领养宠物狗免费的地方）">领养宠物狗app（领养宠物狗免费的地方）</a></li>
                        <li class="py-2"><a href="/html/category/article-7768.htm" title="领养宠物正规网站有哪些（领养宠物正规网站有哪些平台）">领养宠物正规网站有哪些（领养宠物正规网站有哪些平台）</a></li>
                        <li class="py-2"><a href="/html/category/article-7125.htm" title="动物疫苗的使用方法有哪些 动物疫苗的使用方法有哪些种类">动物疫苗的使用方法有哪些 动物疫苗的使用方法有哪些种类</a></li>
                        <li class="py-2"><a href="/html/category/article-7723.htm" title="动物疫病防控中心可以打疫苗吗 动物疫病防控中心可以打疫苗吗多少钱">动物疫病防控中心可以打疫苗吗 动物疫病防控中心可以打疫苗吗多少钱</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">36</span> <a href="/html/date/2024-08/" title="2024-08 归档">2024-08</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-07/" title="2024-07 归档">2024-07</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-06/" title="2024-06 归档">2024-06</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-05/" title="2024-05 归档">2024-05</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-04/" title="2024-04 归档">2024-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-03/" title="2024-03 归档">2024-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">54</span> <a href="/html/date/2024-02/" title="2024-02 归档">2024-02</a></h4>
            </li>
                    </ul>
    </div>
</div>

                </div>
            </div>
        </div>
    </section>
        <footer class="ftco-footer ftco-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <p>
                        FinlandAddress 版权所有
                        <br />
                        Powered by WordPress
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00" /></svg></div>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery-migrate-3.0.1.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/popper.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/bootstrap.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery.easing.1.3.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery.waypoints.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery.stellar.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/owl.carousel.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery.magnific-popup.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/jquery.animateNumber.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/scrollax.min.js"></script>
    <script src="/assets/addons/xcblog/js/frontend/finlandaddress/main.js"></script>
    <script>
    $(function() {
        $('.js_to').click(function(){
            var url = $(this).data('url');
            var code = $(this).data('code');
            url += code;

            window.open(url);
        })
    });
    </script>
</body>

</html>